

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bullet Softbody Patch &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../../../index.html"/>
        <link rel="up" title="Using Bullet with Panda3D" href="index.html"/>
        <link rel="next" title="Bullet Softbody Triangles" href="softbody-triangles.html"/>
        <link rel="prev" title="Bullet Softbody Rope" href="softbody-rope.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Programming with Panda3D</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../the-scene-graph/index.html">The Scene Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../the-configuration-file/index.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models-and-actors/index.html">Models and Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-attributes/index.html">Render Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../texturing/index.html">Texturing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shaders/index.html">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../camera-control/index.html">Camera Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sound/index.html">Sound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intervals/index.html">Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tasks-and-event-handling/index.html">Tasks and Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../text-and-image-rendering/index.html">Text and Image Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../directgui/index.html">DirectGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-effects/index.html">Render Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../finite-state-machines/index.html">Finite State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../terrain/index.html">Terrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-structures/index.html">Advanced operations with Panda3D&#8217;s internal structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-to-texture-and-image-postprocessing/index.html">Render-to-Texture and Image Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../panda3d-rendering-process/index.html">Panda3D Rendering Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../panda3d-utility-functions.html">Panda3D Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../particle-effects/index.html">Particle Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collision-detection/index.html">Collision Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../garbage-collection/index.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware-support/index.html">Hardware support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math-engine/index.html">Math Engine</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Physics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../panda3d-physics-engine/index.html">Panda3D Physics Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ode/index.html">Using ODE with Panda3D</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Using Bullet with Panda3D</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="hello-world.html">Bullet Hello World</a></li>
<li class="toctree-l4"><a class="reference internal" href="debug-renderer.html">Bullet Debug Renderer</a></li>
<li class="toctree-l4"><a class="reference internal" href="collision-shapes.html">Bullet Collision Shapes</a></li>
<li class="toctree-l4"><a class="reference internal" href="collision-filtering.html">Bullet Collision Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="ccd.html">Bullet Continuous Collision Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="queries.html">Bullet Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="ghosts.html">Bullet Ghosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="character-controller.html">Bullet Character Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="constraints.html">Bullet Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="vehicles.html">Bullet Vehicles</a></li>
<li class="toctree-l4"><a class="reference internal" href="softbodies.html">Bullet Softbodies</a></li>
<li class="toctree-l4"><a class="reference internal" href="softbody-rope.html">Bullet Softbody Rope</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Bullet Softbody Patch</a></li>
<li class="toctree-l4"><a class="reference internal" href="softbody-triangles.html">Bullet Softbody Triangles</a></li>
<li class="toctree-l4"><a class="reference internal" href="softbody-tetrahedron.html">Bullet Softbody Tetrahedron</a></li>
<li class="toctree-l4"><a class="reference internal" href="softbody-config.html">Bullet Softbody Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-options.html">Bullet Config Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html">Bullet FAQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="samples.html">Bullet Samples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../motion-paths.html">Motion Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing/index.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multifiles/index.html">Multifiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../showbase.html">ShowBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file-reading.html">File Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subclassing.html">Subclassing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../table-of-features-supported-per-graphic-renderer.html">Table of features supported per graphic renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pandai/index.html">Artificial Intelligence (PANDAI)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance-tuning/index.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Programming with Panda3D</a> &raquo;</li>
      
          <li><a href="../index.html">Physics</a> &raquo;</li>
      
          <li><a href="index.html">Using Bullet with Panda3D</a> &raquo;</li>
      
    <li>Bullet Softbody Patch</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/programming-with-panda3d/physics/bullet/softbody-patch.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bullet-softbody-patch">
<span id="softbody-patch"></span><h1>Bullet Softbody Patch<a class="headerlink" href="#bullet-softbody-patch" title="Permalink to this headline">¶</a></h1>
<p>Soft body patches are two-dimensional rectangular meshes, which can be used to
simulate for example a flag, a tapestry, or sheets of paper.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Setting up a soft body patch is similar to soft body ropes, but a few extra
settings have to be done. The following code will create rectangular path with
31 by 31 segments, and thus 32 x 32 nodes.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">panda3d.bullet</span> <span class="kn">import</span> <span class="n">BulletSoftBodyNode</span>

<span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">getWorldInfo</span><span class="p">()</span>
<span class="n">info</span><span class="o">.</span><span class="n">setAirDensity</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">setWaterDensity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">setWaterOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">setWaterNormal</span><span class="p">(</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">resx</span> <span class="o">=</span> <span class="mi">31</span>
<span class="n">resy</span> <span class="o">=</span> <span class="mi">31</span>

<span class="n">p00</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p10</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p01</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p11</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">fixeds</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">8</span>
<span class="n">gendiags</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">bodyNode</span> <span class="o">=</span> <span class="n">BulletSoftBodyNode</span><span class="o">.</span><span class="n">makePatch</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">p00</span><span class="p">,</span> <span class="n">p10</span><span class="p">,</span> <span class="n">p01</span><span class="p">,</span> <span class="n">p11</span><span class="p">,</span> <span class="n">resx</span><span class="p">,</span> <span class="n">resy</span><span class="p">,</span> <span class="n">fixeds</span><span class="p">,</span> <span class="n">gendiags</span><span class="p">)</span>

<span class="n">material</span> <span class="o">=</span> <span class="n">bodyNode</span><span class="o">.</span><span class="n">appendMaterial</span><span class="p">()</span>
<span class="n">material</span><span class="o">.</span><span class="n">setLinearStiffness</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">bodyNode</span><span class="o">.</span><span class="n">generateBendingConstraints</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>

<span class="n">bodyNode</span><span class="o">.</span><span class="n">setTotalMass</span><span class="p">(</span><span class="mf">50.0</span><span class="p">)</span>
<span class="n">bodyNode</span><span class="o">.</span><span class="n">getShape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">bodyNP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">worldNP</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">bodyNode</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">attachSoftBody</span><span class="p">(</span><span class="n">bodyNode</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<p>First we have to configure the soft body world properties, like we did for
soft body ropes too. Next we define variables for the resolution in x- and
y-direction, and for the four corner points of the patch.</p>
<p>The variable fixeds is set to the value 1+2+4+8=15, meaning that the patch
should be attached to the world on all four corners. To attach it to the first
and third corner (diagonal) we would set the value to 1+8=9, and to not attach
it at all we would set it to 0.</p>
<p>Now we can create the soft body node using the factory method
<code class="docutils literal"><span class="pre">makePatch</span></code>. The following
configuration differs from what we have seen for soft body ropes.</p>
<ul class="simple">
<li>First we create an additional material attached to the soft body. Initially
a soft body has already one material, but for this example we want a second
one.</li>
<li>On the material we set the linear stiffness, and the create bending
constraints for this material.</li>
<li>Finally we choose a value of about the grid spacing for the soft bodies
margin. Other bodies colliding with the soft body could fall through in
between the nodes if the value is too small, and if it is too large they
will already collide with the soft body when still noticeably far away.</li>
</ul>
</div>
<div class="section" id="visualisation">
<h2>Visualisation<a class="headerlink" href="#visualisation" title="Permalink to this headline">¶</a></h2>
<p>In order to have a visual representation of the soft body patch we need a
<code class="docutils literal"><span class="pre">GeomNode</span></code>. Panda3D&#8217;s Bullet
module has a helper method which will do the work for us. The following code
snippet shows how use this helper method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">panda3d.core</span> <span class="kn">import</span> <span class="n">GeomVertexFormat</span>
<span class="kn">from</span> <span class="nn">panda3d.bulletimport</span> <span class="nn">BulletHelper</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="n">GeomVertexFormat</span><span class="o">.</span><span class="n">getV3n3t2</span><span class="p">()</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">BulletHelper</span><span class="o">.</span><span class="n">makeGeomFromFaces</span><span class="p">(</span><span class="n">bodyNode</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">bodyNode</span><span class="o">.</span><span class="n">linkGeom</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="n">visNode</span> <span class="o">=</span> <span class="n">GeomNode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">visNode</span><span class="o">.</span><span class="n">addGeom</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="n">visNP</span> <span class="o">=</span> <span class="n">bodyNP</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">visNode</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<p>The third parameter to <code class="docutils literal"><span class="pre">makeGeomFromFaces</span></code>
is set to <code class="docutils literal"><span class="pre">True</span></code>, making the
created geometry be two-sided. If set to
<code class="docutils literal"><span class="pre">False</span></code> we would get a
one-sided geometry, which might be enough, depending on your requirements.</p>
<p>So far the generated geometry has no texture and no texture coordinates. But
the texture has already a column for texcoords, so we just need to write
texcoords using a <code class="docutils literal"><span class="pre">GeomVertexRewriter</span></code>. The
following code shows a convenience method which will do this for us.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tex</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadTexture</span><span class="p">(</span><span class="s1">&#39;models/panda.jpg&#39;</span><span class="p">)</span>
<span class="n">visNP</span><span class="o">.</span><span class="n">setTexture</span><span class="p">(</span><span class="n">tex</span><span class="p">)</span>
<span class="n">BulletHelper</span><span class="o">.</span><span class="n">makeTexcoordsForPatch</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">resx</span><span class="p">,</span> <span class="n">resy</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<p>Note: It is also possible to render soft body patches using a
<code class="docutils literal"><span class="pre">NurbsSurfaceEvaluator</span></code> and
<code class="docutils literal"><span class="pre">SheetNode</span></code>, but results are
usually better when rendering patches directly, that is using linked
<code class="docutils literal"><span class="pre">Geom</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="softbody-triangles.html" class="btn btn-neutral float-right" title="Bullet Softbody Triangles" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="softbody-rope.html" class="btn btn-neutral" title="Bullet Softbody Rope" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>