

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Event Handlers &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../../index.html"/>
        <link rel="up" title="Tasks and Event Handling" href="index.html"/>
        <link rel="next" title="Main Loop" href="main-loop.html"/>
        <link rel="prev" title="Task Chains" href="task-chains.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Programming with Panda3D</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../the-scene-graph/index.html">The Scene Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-configuration-file/index.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models-and-actors/index.html">Models and Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-attributes/index.html">Render Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../texturing/index.html">Texturing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaders/index.html">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../camera-control/index.html">Camera Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/index.html">Sound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intervals/index.html">Intervals</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tasks and Event Handling</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="task-chains.html">Task Chains</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Event Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="main-loop.html">Main Loop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../text-and-image-rendering/index.html">Text and Image Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../directgui/index.html">DirectGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-effects/index.html">Render Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finite-state-machines/index.html">Finite State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../terrain/index.html">Terrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-structures/index.html">Advanced operations with Panda3D&#8217;s internal structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-to-texture-and-image-postprocessing/index.html">Render-to-Texture and Image Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-rendering-process/index.html">Panda3D Rendering Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-utility-functions.html">Panda3D Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../particle-effects/index.html">Particle Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collision-detection/index.html">Collision Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../garbage-collection/index.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware-support/index.html">Hardware support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math-engine/index.html">Math Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../physics/index.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../motion-paths.html">Motion Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing/index.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multifiles/index.html">Multifiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../showbase.html">ShowBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file-reading.html">File Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subclassing.html">Subclassing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../table-of-features-supported-per-graphic-renderer.html">Table of features supported per graphic renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pandai/index.html">Artificial Intelligence (PANDAI)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance-tuning/index.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Programming with Panda3D</a> &raquo;</li>
      
          <li><a href="index.html">Tasks and Event Handling</a> &raquo;</li>
      
    <li>Event Handlers</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/programming-with-panda3d/tasks-and-event-handling/event-handlers.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="event-handlers">
<span id="id1"></span><h1>Event Handlers<a class="headerlink" href="#event-handlers" title="Permalink to this headline">¶</a></h1>
<p>Events occur either when the user does something (such as clicking a
<a class="reference internal" href="../hardware-support/mouse-support.html#mouse-support"><span class="std std-ref">mouse</span></a> or pressing a <a class="reference internal" href="../hardware-support/keyboard-support.html#keyboard-support"><span class="std std-ref">key</span></a>) or
when sent by the script using
<code class="docutils literal"><span class="pre">messenger.send()</span></code>. When an event occurs,
Panda&#8217;s &#8220;messenger&#8221; will check to see if you have written an &#8220;event handler&#8221;
routine. If so, your event handler will be called. The messenger system is
object-oriented, to create an event handler, you have to first create a class
that inherits from DirectObject. Your event handler will be a method of your
class.</p>
<div class="section" id="defining-a-class-that-can-handle-events">
<h2>Defining a class that can Handle Events<a class="headerlink" href="#defining-a-class-that-can-handle-events" title="Permalink to this headline">¶</a></h2>
<p>The first step is to import class DirectObject:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">direct.showbase</span> <span class="kn">import</span> <span class="n">DirectObject</span>
</pre></div>
</div>
<p>With DirectObject loaded, it is possible to create a subclass of DirectObject.
This allows the class to inherit the messaging API and thus listen for events.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myClassName</span><span class="p">(</span><span class="n">DirectObject</span><span class="o">.</span><span class="n">DirectObject</span><span class="p">):</span>
</pre></div>
</div>
<p>The sample below creates a class that can listen for events. The &#8220;accept&#8221;
function notifies panda that the printHello method is an event handler for the
mouse1 event. The &#8220;accept&#8221; function and the various event names will be
explained in detail later.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hello</span><span class="p">(</span><span class="n">DirectObject</span><span class="o">.</span><span class="n">DirectObject</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;mouse1&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">printHello</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">printHello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="s1">&#39;Hello!&#39;</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Hello</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="event-handling-functions">
<h2>Event Handling Functions<a class="headerlink" href="#event-handling-functions" title="Permalink to this headline">¶</a></h2>
<p>Events first go to a mechanism built into panda called the &#8220;Messenger.&#8221; The
messenger may accept or ignore events that it receives. If it accepts an
event, then an event handler will be called. If ignored, then no handler will
be called.</p>
<p>An object may accept an event an infinite number of times or accept it only
once. If checking for an accept within the object listening to it, it should
be prefixed with self. If the accept command occurs outside the class, then
the variable the class is associated with should be used.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myDirectObject</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;Event Name&#39;</span><span class="p">,</span><span class="n">myDirectObjectMethod</span><span class="p">)</span>
<span class="n">myDirectObject</span><span class="o">.</span><span class="n">acceptOnce</span><span class="p">(</span><span class="s1">&#39;Event Name&#39;</span><span class="p">,</span><span class="n">myDirectObjectMethod</span><span class="p">)</span>
</pre></div>
</div>
<p>Specific events may be ignored, so that no message is sent. Also, all events
coming from an object may be ignored.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myDirectObject</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="s1">&#39;Event Name&#39;</span><span class="p">)</span>
<span class="n">myDirectObject</span><span class="o">.</span><span class="n">ignoreAll</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, there are some useful utility functions for debugging. The messenger
typically does not print out when every event occurs. Toggling verbose mode
will make the messenger print every event it receives. Toggling it again will
revert it to the default. A number of methods exist for checking to see what
object is checking for what event, but the print method will show who is
accepting each event. Also, if accepts keep changing to the point where it is
too confusing, the clear method will start the messenger over with a clear
dictionary.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">messenger</span><span class="o">.</span><span class="n">toggleVerbose</span><span class="p">()</span>
<span class="k">print</span> <span class="n">messenger</span>
<span class="n">messenger</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-custom-events">
<h2>Sending Custom Events<a class="headerlink" href="#sending-custom-events" title="Permalink to this headline">¶</a></h2>
<p>Custom events can be sent by the script using the code</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">messenger</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;Event Name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A list of parameters can optionally be sent to the event handler. Parameters
defined in <code class="docutils literal"><span class="pre">accept()</span></code> are passed
first, and then the parameters defined in
<code class="docutils literal"><span class="pre">send()</span></code>. for example this would
print out &#8220;eggs sausage foo bar&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">DirectObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnSpam</span><span class="p">,[</span><span class="s1">&#39;eggs&#39;</span><span class="p">,</span><span class="s1">&#39;sausage&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">OnSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span>
<span class="n">Test</span><span class="p">()</span>
<span class="n">messenger</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">,[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span><span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="a-note-on-object-management">
<h2>A Note on Object Management<a class="headerlink" href="#a-note-on-object-management" title="Permalink to this headline">¶</a></h2>
<p>When a DirectObject accepts an event, the messenger retains a reference to
that DirectObject. To ensure that objects that are no longer needed are
properly disposed of, they must ignore any messages they are accepting.</p>
<p>For example, the following code may not do what you expect:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">direct.directbase.DirectStart</span>
<span class="kn">from</span> <span class="nn">direct.showbase</span> <span class="kn">import</span> <span class="n">DirectObject</span>
<span class="kn">from</span> <span class="nn">panda3d.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">DirectObject</span><span class="o">.</span><span class="n">DirectObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s2">&quot;FireZeMissiles&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fireMissiles</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fireMissiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s2">&quot;Missiles fired! Oh noes!&quot;</span>


<span class="n">foo</span><span class="o">=</span><span class="n">Test</span><span class="p">()</span> <span class="c1"># create our test object</span>

<span class="k">del</span> <span class="n">foo</span>    <span class="c1"># get rid of our test object</span>

<span class="n">messenger</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;FireZeMissiles&quot;</span><span class="p">)</span> <span class="c1"># oops! Why did those missiles fire?</span>
<span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Try the example above, and you&#8217;ll find that the missiles fire even though the
object that would handle the event had been deleted.</p>
<p>One solution (patterned after other parts of the Panda3d architecture) is to
define a &#8220;destroy&#8221; method for any custom classes you create, which calls
&#8220;ignoreAll&#8221; to unregister from the event-handler system.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">direct.directbase.DirectStart</span>
<span class="kn">from</span> <span class="nn">direct.showbase</span> <span class="kn">import</span> <span class="n">DirectObject</span>
<span class="kn">from</span> <span class="nn">panda3d.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">DirectObject</span><span class="o">.</span><span class="n">DirectObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s2">&quot;FireZeMissiles&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fireMissiles</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fireMissiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s2">&quot;Missiles fired! Oh noes!&quot;</span>

    <span class="c1"># function to get rid of me</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreAll</span><span class="p">()</span>


<span class="n">foo</span><span class="o">=</span><span class="n">Test</span><span class="p">()</span> <span class="c1"># create our test object</span>

<span class="n">foo</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>    <span class="c1"># get rid of our test object</span>
<span class="k">del</span> <span class="n">foo</span>

<span class="n">messenger</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;FireZeMissiles&quot;</span><span class="p">)</span> <span class="c1"># No missiles fire</span>
<span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="main-loop.html" class="btn btn-neutral float-right" title="Main Loop" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="task-chains.html" class="btn btn-neutral" title="Task Chains" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>