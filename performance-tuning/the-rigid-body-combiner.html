

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Rigid Body Combiner &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../index.html"/>
        <link rel="up" title="Performance Tuning" href="index.html"/>
        <link rel="next" title="Performance Issue: Too Many Meshes" href="too-many-meshes.html"/>
        <link rel="prev" title="Measuring Performance with PStats" href="measuring-performance-with-pstats.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming-with-panda3d/index.html">Programming with Panda3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/index.html">Debugging</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Performance Tuning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic-performance-diagnostics.html">Basic Performance Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="measuring-performance-with-pstats.html">Measuring Performance with PStats</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Rigid Body Combiner</a></li>
<li class="toctree-l2"><a class="reference internal" href="too-many-meshes.html">Performance Issue: Too Many Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="too-many-state-changes.html">Performance Issue: Too Many State Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="too-many-text-updates.html">Performance Issue: Too Many Text Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="too-many-shader-instructions.html">Performance Issue: Too Many Shader Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="excessive-fill.html">Performance Issue: Excessive Fill</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory-full.html">Performance Issue: Memory Full</a></li>
<li class="toctree-l2"><a class="reference internal" href="python-calculation.html">Performance Issue: Python Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="failure-to-garbage-collect.html">Performance Issue: Failure to Garbage Collect</a></li>
<li class="toctree-l2"><a class="reference internal" href="collision-system-misuse.html">Performance Issue: Collision System Misuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="motherboard-integrated-video.html">Performance Issue: Motherboard Integrated Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="too-many-polygons.html">Performance Issue: Too Many Polygons</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html">Performance Issue: Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Performance Tuning</a> &raquo;</li>
      
    <li>The Rigid Body Combiner</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/performance-tuning/the-rigid-body-combiner.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-rigid-body-combiner">
<span id="id1"></span><h1>The Rigid Body Combiner<a class="headerlink" href="#the-rigid-body-combiner" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>The Rigid Body Combiner<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>When you are developing a complex game, you will most likely run into the
problem that you will have :ref:` &lt;too-many-meshes&gt;` in your scene. Panda3D&#8217;s
flattening methods can help you reducing the number of nodes, but often when
you have hundreds of moving bodies this is not always an option. Therefore,
Panda3D has a feature to help you reduce the number of nodes, even if they are
moving: the RigidBodyCombiner. The RigidBodyCombiner is designed to reduce the
number of nodes actually sent to the graphics card, just like the flattening
functions. But instead of flattening everything into one node immediately, the
RigidBodyCombiner keeps your original node structure intact, still allowing
you to apply transforms (e.g. moving around, rotating or scaling) sub-nodes.
But what&#8217;s actually sent to the graphics cards is just one node, a combined
version of all these sub-nodes. If you want to see the combined version of
these nodes (not likely), you can call
<code class="docutils literal"><span class="pre">getInternalScene()</span></code>, this function will
return the NodePath that is actually sent to the graphics card. The
RigidBodyCombiner class is just another kind of PandaNode. All of the standard
node interfaces apply. Thus, the easiest way to add nodes to a
RigidBodyCombiner is to wrap a NodePath around it, and then use the standard
<code class="docutils literal"><span class="pre">reparentTo()</span></code> interfaces to parent
the nodes you want to combine to this NodePath. When you are done with
reparenting the nodes, you need to call
<code class="docutils literal"><span class="pre">collect()</span></code> on the original
<code class="docutils literal"><span class="pre">RigidBodyCombiner</span></code> instance. This is a
fairly expensive call and you should normally only call this once &#8211; but after
you called <code class="docutils literal"><span class="pre">collect()</span></code> you may
freely transform all nodes below without having to call this again. If you
later add more children to the RBC, though, you will need to call
<code class="docutils literal"><span class="pre">collect()</span></code> again. The vertices of
the objects you attach to the RigidBodyCombiner must be transformed each frame
on the CPU. For this reason, you may find a performance advantage in limiting
the number of vertices in the models you use. Also, be sure you do not have
normals on your models unless you are actually using lighting. Here is a small
example showing a random cloud of boxes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">direct.directbase.DirectStart</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">panda3d.core</span> <span class="kn">import</span> <span class="n">RigidBodyCombiner</span><span class="p">,</span> <span class="n">NodePath</span><span class="p">,</span> <span class="n">Vec3</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">rbc</span> <span class="o">=</span> <span class="n">RigidBodyCombiner</span><span class="p">(</span><span class="s2">&quot;rbc&quot;</span><span class="p">)</span>
<span class="n">rbcnp</span> <span class="o">=</span> <span class="n">NodePath</span><span class="p">(</span><span class="n">rbc</span><span class="p">)</span>
<span class="n">rbcnp</span><span class="o">.</span><span class="n">reparentTo</span><span class="p">(</span><span class="n">render</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
               <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
               <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="s2">&quot;box.egg&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">reparentTo</span><span class="p">(</span><span class="n">rbcnp</span><span class="p">)</span>

<span class="n">rbc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note:
:ref:` &lt;render-effects&gt;` such as :ref:` &lt;billboard-effects&gt;` are not supported
below this node. For more information and a complete list of RigidBodyCombiner
functions please see the <a class="reference external" href="https://www.panda3d.org/apiref.php?page=RigidBodyCombiner">API
reference</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="too-many-meshes.html" class="btn btn-neutral float-right" title="Performance Issue: Too Many Meshes" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="measuring-performance-with-pstats.html" class="btn btn-neutral" title="Measuring Performance with PStats" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>